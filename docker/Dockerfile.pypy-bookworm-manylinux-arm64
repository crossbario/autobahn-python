# PyPy 3.11 on Debian 12 (Bookworm) - manylinux_2_36_aarch64 compatible
# Multi-arch support: linux/amd64, linux/arm64/v8
FROM pypy:3.11-bookworm

LABEL maintainer="The Crossbar.io Project <support@crossbario.com>"
LABEL manylinux.tag="manylinux_2_36_aarch64"
LABEL glibc.version="2.36"

# PyPy QEMU stability workarounds
# Disable JIT compiler and force single-threaded execution for stable QEMU emulation
ENV PYPY_DISABLE_JIT=1
ENV PYPY_GC_NTHREADS=1
ENV PYPY_FORCE_CPU_COUNT=1

# Install build essentials for wheel compilation
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    patchelf \
    libffi-dev \
    libssl-dev \
    libsnappy-dev \
    && pip install --upgrade pip \
    && pip install auditwheel \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /io
